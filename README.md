# x402r Verifiable Arbiter on EigenCloud

Verifiable payment dispute arbiter running on [EigenCloud](https://www.eigencloud.xyz/) for the [x402r](https://x402r.org) refundable payments protocol.

When agents transact via x402r (HTTP 402 + escrow + refunds), disputes need a trusted resolver. This arbiter runs in a TEE on EigenCompute and uses EigenAI for deterministic, verifiable rulings — no hidden bias, fully auditable.

## How It Works

1. **Watch** for `RefundRequested` events on-chain (x402r contracts)
2. **Fetch** evidence from `RefundRequestEvidence` contract (IPFS CIDs)
3. **Decide** using EigenAI with a fixed seed (deterministic inference)
4. **Commit** decision hash on-chain (prompt hash + seed + response hash)
5. **Execute** decision via x402r SDK (approve/deny refund)

Anyone can **replay** the same prompt + seed on EigenAI and verify the ruling matches the on-chain commitment.

## Architecture

```
EigenCloud TEE
├── Arbiter Server (TypeScript)
│   ├── Event watcher (x402r contracts)
│   ├── Evidence collector (on-chain + IPFS)
│   ├── EigenAI client (wallet-signed grant auth)
│   └── On-chain executor (@x402r/arbiter SDK)
│
├── EigenAI (deterministic LLM inference, seed-locked)
└── TEE wallet (auto-generated by KMS)

On-chain (Base Sepolia)
├── RefundRequest (dispute lifecycle)
├── RefundRequestEvidence (IPFS CIDs)
└── PaymentOperator (escrow + refund execution)
```

## Development

```bash
npm install
cp .env.example .env
npm run dev
```

### Verify EigenAI Connection

```bash
npx ts-node src/verify-eigenai.ts
```

## Deployment

```bash
# Deploy to EigenCompute TEE
ecloud compute app deploy
```

### Management

```bash
ecloud compute app info         # App details
ecloud compute app logs         # View logs
ecloud compute app stop         # Stop app
ecloud compute app terminate    # Terminate app
```

## License

MIT
